## 实践笔记

### sql

- 判断是否为空

  ```sql
  exch is null 
  ```

- 判断语句加上正则表达式匹配所有数字

  ```sql
  case
  	when REGEXP_LIKE(netcartrate,'(^[+-]?\d{0,}\.?\d{0,}$)') then
  		netcartrate || 'M'
  	else
  		netcartrate
  	end 
  		netcartrate

  --简单Case函数
  CASE sex
  WHEN '1' THEN '男'
  WHEN '2' THEN '女'
  ELSE '其他' END
  --Case搜索函数
  CASE WHEN sex = '1' THEN '男'
  WHEN sex = '2' THEN '女'
  ELSE '其他' END
  --正则表达式
  ^ 匹配输入字符串的开始位置
  [+-] 匹配指定范围内的任意字符
  ? 匹配0或1个正好在它之前的那个字符
  \d 匹配一个数字字符
  {n,} n是一个非负整数。至少匹配前面的n次
  $ 匹配输入字符串的结束位置
  ```


- 按规律更新

  ```sql
  UPDATE temp_userid t
  SET t.ctime = (
  		SELECT max(b.btime)
  		FROM vi_speed_info b
  		WHERE b.userid = t.userid
  		)
  --MAX 函数返回一列中的最大值
  ```

- 同时更新两个字段

  ```sql
  UPDATE test_for_search t
  SET (
  		t.stime
  		,t.responserate
  		) = (
  		SELECT a.stime,a.responserate
  		FROM (
  			SELECT userid,responserate,stime
  			FROM (
  				SELECT b.userid
  					,b.responserate
  					,b.stime
  					,row_number() OVER (PARTITION BY b.userid ORDER BY b.stime) AS ind
  				FROM v_speed_info_bday b
  					,test_for_search t
  				WHERE b.userid = t.userid
  					AND b.stime BETWEEN to_date('2016-03-10 000000', 'yyyy-mm-dd hh24miss')
  						AND to_date('2016-03-10 235959', 'yyyy-mm-dd hh24miss')
  				GROUP BY b.userid,b.responserate,b.stime
  				)
  			WHERE ind = 1
  			) a
  		WHERE a.userid = t.userid
  		)
  --分析函数OVER(PARTITION BY)
  ```